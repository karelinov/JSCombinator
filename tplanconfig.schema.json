{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "http://msr.com/schemas/tplan/tplanconfig",
  "type":"array",
  "description": "Упорядоченный список аспектов",
  "items": {"$ref":"#/$defs/aspect"},

  
  "$defs": {
    "aspect":{
      "description":"Типовой узел аспектов, требующих тестирования",
      "type":"object",
      "properties":  {
        "id":{"type": "integer", "description":"Уникальный идентификатор аспекта"},
        "aspectgroup": {"$ref":"#/$defs/aspectgroup"},
        "aspectdependency": {"$ref":"#/$defs/aspectdependency"}
      },
      "required": ["id","aspectgroup"]
    },
    "aspectgroup": {
      "description": "группа значений аспекта (собственно аспект)",
      "type": "object",
      "properties": {
        "id": {"type": "string", "description":"id группы (аспекта)" },
        "name": {"type": "string", "description":"название группы (аспекта)" },
        "values":{
          "type": "array",
          "items": {"$ref":"#/$defs/aspectitem"}
        },
        "restrictions": {
          "type": "array",
          "items": {"$ref":"#/$defs/aspectrestriction"}
        }
      },
      "required":["id","name","values"]
    },
    "aspectitem": {
      "description": "одно из значений аспекта",
      "type":"object",
      "properties": {
        "id": {"type": "integer", "description":"идентификатор аспекта в группе" },
        "name": {"type": "string", "description":"название значения" }
      },
      "required":["id","name"]
    },
    "aspectrestriction": {
      "description": "ограничение в использовании аспекта в плане (пока заглушка)",
      "type": "object",
      "properties":{
          "type": {"type":"string", "enum": ["restrict","exclude"], "description": "Тип ограничения (оставить указанные/исключить указанные)" },
          "scope": {"type":"string", "enum": ["local","global"], "description": "Область ограничения (аспект/стек аспектов)" },   
          "rule": {
            "type":"array", 
            "description": "Тексты ограничений",
            "items": {"type":"string"}
          }  
      },
      "required":["type","scope","rule"]
    },
    "aspectdependency": {
      "description": "зависимость к другому аспекту",
      "type": "object",
      "properties":{
          "aspect_id": {"type":"string", "description": "ID аспекта" },
          "type": {"type":"string", "enum": ["restriction","combine"], "description": "Тип зависимости (ограничения на комбинации/все комбинации)" },
          "rule": {
            "type":"array", 
            "description": "Тексты ограничений",
            "items": {"type":"string"}
          }  
      },
      "required":["aspect_id","type","scope","rule"]
    }


  }
}